!function(e){if("function"==typeof define&&define.amd)define(["leaflet"],e);else if("undefined"!=typeof module)module.exports=e(require("leaflet"));else{if("undefined"==typeof window.L)throw new Error("Leaflet must be loaded first");e(window.L)}}(function(e){var t={Base:"base",Other:"other"};e.Control.SwitchMap=e.Control.extend({options:{position:"topright",autoZIndex:!0},initialize:function(r,a,s){e.Util.setOptions(this,s),this._layerControlInputs=[],this._layerControlLabels=[],this._layers=[],this._otherLayers=a,this._lastZIndex=0,this._handlingClick=!1;var i;for(i=0;i<r.length;i++)this._addLayer(r[i].layer,r[i].name,t.Base);if("undefined"!=typeof a&&a instanceof Array)for(i=0;i<a.length;i++)this._addLayer(a[i].layer,a[i].name,t.Other)},onAdd:function(e){this._initLayout(),this._update(),this._map=e,e.on("zoomend",this._checkDisabledLayers,this);for(var t=0;t<this._layers.length;t++)this._layers[t].layer.on("add remove",this._onLayerChange,this);return this._container},addTo:function(t){return e.Control.prototype.addTo.call(this,t),this},onRemove:function(){this._map.off("zoomend",this._checkDisabledLayers,this);for(var e=0;e<this._layers.length;e++)this._layers[e].layer.off("add remove",this._onLayerChange,this)},replaceOtherLayers:function(r){this._layers=this._layers.filter(function(e){return e.type!==t.Other});var a=[];r=r.filter(function(t){var r;r=t.layer instanceof e.LayerGroup?t.layer.getLayers()[0]._url:t.layer._url;var s=a.indexOf(r)===-1;return r&&s&&a.push(r),s});for(var s=0;s<r.length;s++)this._addLayer(r[s].layer,r[s].name,t.Other);this._update()},getOtherLayers:function(){return this._layers.filter(function(e){return e.type===t.Other})},_initLayout:function(){var t="leaflet-control-switchmap",r=this._container=e.DomUtil.create("div",t);r.setAttribute("aria-haspopup",!0),e.DomEvent.disableClickPropagation(r),e.DomEvent.disableScrollPropagation(r);var a=this._form=e.DomUtil.create("form",t+"-list"),s=this._controls=e.DomUtil.create("div",t+"-controls");if(this._hasBaseLayers()&&(this._baseLayersList=e.DomUtil.create("div",t+"-base leaflet-bar",s)),"undefined"!=typeof this._otherLayers&&this._otherLayers){this._otherLayersBtn=e.DomUtil.create("div",t+"-other-btn leaflet-bar",s),e.DomUtil.create("span","icon icon-world",this._otherLayersBtn),this._otherLayersBtn.innerHTML+=this.options.textMoreMaps;var i=this._otherLayersBtnArrow=e.DomUtil.create("img","leaflet-more-maps-arrow",this._otherLayersBtn);i.src="https://sc.wklcdn.com/wikiloc/images/markers/small_arrow_down.png",e.DomEvent.on(this._otherLayersBtn,"click",this._toggleOtherLayers,this),e.DomEvent.disableClickPropagation(this._otherLayersBtn)}this._otherLayersList=e.DomUtil.create("div",t+"-other"),a.appendChild(s),a.appendChild(this._otherLayersList),r.appendChild(a)},_getLayer:function(t){for(var r=0;r<this._layers.length;r++)if(this._layers[r]&&e.Util.stamp(this._layers[r].layer)===t)return this._layers[r]},_getLabel:function(e){for(var t=0;t<this._layerControlLabels.length;t++)if(this._layerControlLabels[t].layerId===e)return this._layerControlLabels[t]},_addLayer:function(e,t,r){this._map&&e.on("add remove",this._onLayerChange,this),this._layers.push({layer:e,name:t,type:r}),this.options.autoZIndex&&e.setZIndex&&(this._lastZIndex++,e.setZIndex(this._lastZIndex))},_update:function(){if(!this._container)return this;this._baseLayersList&&e.DomUtil.empty(this._baseLayersList),this._otherLayersList&&e.DomUtil.empty(this._otherLayersList),this._layerControlInputs=[],this._layerControlLabels=[];for(var t=0;t<this._layers.length;t++)this._addItem(this._layers[t]);return this},_onLayerChange:function(t){this._handlingClick||this._update();var r=this._getLayer(e.Util.stamp(t.target)),a="add"===t.type?"baselayerchange":null;a&&this._map.fire(a,r)},_createRadioElement:function(e,t){var r='<input type="radio" class="leaflet-control-switchmap-selector" name="'+e+'"'+(t?' checked="checked"':"")+"/>",a=document.createElement("div");return a.innerHTML=r,a.firstChild},_addItem:function(t){var r,a=document.createElement("label"),s=this._map.hasLayer(t.layer);r=this._createRadioElement("leaflet-layers",s),s&&e.DomUtil.addClass(a,"checked"),this._layerControlInputs.push(r),this._layerControlLabels.push(a),a.layerId=r.layerId=e.Util.stamp(t.layer),e.DomEvent.on(r,"click",this._onInputClick,this);var i=document.createElement("span");i.innerHTML=t.name;var o=document.createElement("div");a.appendChild(o),o.appendChild(r),o.appendChild(i);var n=this["_"+t.type+"LayersList"];return n.appendChild(a),this._checkDisabledLayers(),a},_onInputClick:function(){var t,r,a,s=this._layerControlInputs,i=[],o=[];this._handlingClick=!0,this.closeOtherLayers();for(var n=s.length-1;n>=0;n--)t=s[n],a=this._getLayer(t.layerId).layer,r=this._getLabel(t.layerId),t.checked?(i.push(a),e.DomUtil.addClass(r,"checked")):t.checked||(o.push(a),e.DomUtil.removeClass(r,"checked"));for(n=0;n<o.length;n++)this._map.hasLayer(o[n])&&this._map.removeLayer(o[n]);for(n=0;n<i.length;n++)this._map.hasLayer(i[n])||this._map.addLayer(i[n]);this._handlingClick=!1,this._refocusOnMap()},_checkDisabledLayers:function(){for(var e,t,r=this._layerControlInputs,a=this._map.getZoom(),s=r.length-1;s>=0;s--){e=r[s],t=this._getLayer(e.layerId).layer;var i=void 0!==t.options.minZoom&&a<t.options.minZoom||void 0!==t.options.maxZoom&&a>t.options.maxZoom;i?e.parentNode.parentNode.style.display="none":e.parentNode.parentNode.style.display="flex"}},_toggleOtherLayers:function(){e.DomUtil.hasClass(this._otherLayersList,"expanded")?(e.DomUtil.removeClass(this._otherLayersList,"expanded"),e.DomUtil.removeClass(this._otherLayersBtnArrow,"flipped")):("undefined"!=typeof this._otherLayers&&this._otherLayers instanceof Function&&this._otherLayers(this),e.DomUtil.addClass(this._otherLayersList,"expanded"),e.DomUtil.addClass(this._otherLayersBtnArrow,"flipped"))},_hasBaseLayers:function(){return this._layers.filter(function(e){return e.type===t.Base}).length>0},closeOtherLayers:function(){e.DomUtil.removeClass(this._otherLayersList,"expanded"),"undefined"!=typeof this._otherLayersBtnArrow&&e.DomUtil.removeClass(this._otherLayersBtnArrow,"flipped")}}),e.control.switchmap=function(t,r,a){return new e.Control.SwitchMap(t,r,a)}});