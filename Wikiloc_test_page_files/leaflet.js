function _defineProperty(t,a,i){return a in t?Object.defineProperty(t,a,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[a]=i,t}L.MapkitMutant=L.Layer.extend({options:{minZoom:4,maxZoom:19,type:"standard",authorizationCallback:function(){},opacity:1,debugRectangle:!1},initialize:function(t){L.Util.setOptions(this,t),L._mapkitInit||(L._mapkitInit=!0,mapkit.init({authorizationCallback:this.options.authorizationCallback,language:this.options.language}))},onAdd:function(t){this._map=t,this._initMutantContainer(),this._initMutant(),t.on("move zoom moveend zoomend",this._update,this),t.on("resize",this._resize,this),t.on("fullscreenchange resize baselayerchange",this._delayedUpdate,this),this._resize()},beforeAdd:function(t){t._addZoomLimit(this)},onRemove:function(t){t._container.removeChild(this._mutantContainer),this._mutantContainer=void 0,t.off("move zoom moveend zoomend",this._update,this),t.off("resize",this._resize,this),t.off("fullscreenchange resize",this._delayedUpdate,this),this._mutant.removeEventListener("region-change-end",this._onRegionChangeEnd,this),this._canvasOverlay&&(this._canvasOverlay.remove(),this._canvasOverlay=void 0),this._mutantCanvas&&(this._mutantCanvas=void 0),L.DomUtil.remove(this._mutantLogo),L.DomUtil.remove(this._mutantLegal),L.DomUtil.remove(this._mutantStyles)},_initMutantContainer:function(){this._map._mutantContainer?this._mutantContainer=this._map._mutantContainer:(this._mutantContainer=L.DomUtil.create("div","leaflet-mapkit-mutant leaflet-top leaflet-left"),this._mutantContainer.id="_MutantContainer_"+L.Util.stamp(this._mutantContainer),this._mutantContainer.style.zIndex="200",this._mutantContainer.style.pointerEvents="none",this._map._mutantContainer=this._mutantContainer),this._map.getContainer().appendChild(this._mutantContainer),this.setElementSize(this._mutantContainer,this._map.getSize())},_initMutant:function(){if(this._mutantContainer){var t=mapkit.Map.MapTypes.Standard;"hybrid"===this.options.type?t=mapkit.Map.MapTypes.Hybrid:"satellite"===this.options.type&&(t=mapkit.Map.MapTypes.Satellite);var a;if(this._map._mutant)a=this._map._mutant,a.mapType=t;else{var i;a=new mapkit.Map(this._mutantContainer,(i={visibleMapRect:this._leafletBoundsToMapkitRect(),showsUserLocation:!1,showsUserLocationControl:!1,showsCompass:"hidden",showsZoomControl:!1},_defineProperty(i,"showsUserLocationControl",!1),_defineProperty(i,"showsScale",!1),_defineProperty(i,"showsMapTypeControl",!1),_defineProperty(i,"mapType",t),i)),this._map._mutant=a}this._mutant=a,L.Util.requestAnimFrame(function t(){this._mutantCanvas||(this._onRegionChangeEnd(),L.Util.requestAnimFrame(t,this))},this),a.addEventListener("region-change-end",this._onRegionChangeEnd,this),this._initMapkitAttribution(t),this._initMutantStyles(t),this.fire("spawned",{mapObject:a}),L.Util.requestAnimFrame(this._onRegionChangeEnd,this),L.Util.requestAnimFrame(this._update,this)}},_leafletBoundsToMapkitRect:function(){var t=this._map.getPixelBounds(),a=this._map.options.crs.scale(this._map.getZoom()),i=t.getTopLeft().divideBy(a),e=t.getBottomRight().divideBy(a),n=L.bounds([i,e]),s=n.getCenter(),o=n.getSize(),m=new mapkit.MapRect(s.x-o.x/2,s.y-o.y/2,o.x,o.y);return m},_mapkitRectToLeafletBounds:function(t){var a=new mapkit.MapPoint(t.minX(),t.maxY()).toCoordinate(),i=new mapkit.MapPoint(t.maxX(),t.minY()).toCoordinate(),e=a.longitude+360*Math.floor(t.minX()),n=i.longitude+360*Math.floor(t.maxX()),s=this._map.getCenter().lng;if(s<e){var o=360*Math.floor((s-e)/360);e+=o,n+=o}else if(s>n){var o=360*Math.ceil((s-n)/360);e+=o,n+=o}return L.latLngBounds([L.latLng(a.latitude,e),L.latLng(i.latitude,n)])},_update:function(){this._map&&this._mutant&&(clearTimeout(this._timeout),this._mutant.setVisibleMapRectAnimated(this._leafletBoundsToMapkitRect(),!1),this._timeout=setTimeout(function(){this._mutant._impl.updatedLabelRegion()}.bind(this),100))},_resize:function(){var t=this._map.getSize();this._mutantContainer.style.width===t.x&&this._mutantContainer.style.height===t.y||(this.setElementSize(this._mutantContainer,t),!this._mutant)},_onRegionChangeEnd:function(){if(this._mutantCanvas||(this._map._mutantCanvas?this._mutantCanvas=this._map._mutantCanvas:(this._mutantCanvas=this._mutantContainer.querySelector("canvas"),this._map._mutantCanvas=this._mutantCanvas)),this._map&&this._mutantCanvas){var t=this._mapkitRectToLeafletBounds(this._mutant.visibleMapRect);L.Util.requestAnimFrame(function(){if(this._canvasOverlay)this._canvasOverlay.setBounds(t);else{if(this._map._canvasOverlay)this._canvasOverlay=this._map._canvasOverlay;else{this._canvasOverlay=L.imageOverlay(null,t),this._canvasOverlay.getEvents=function(){var t={viewreset:this._reset};return this._zoomAnimated&&(t.zoomanim=this._animateZoom),t};var a=this._canvasOverlay._image=L.DomUtil.create("div");L.DomUtil.addClass(a,"leaflet-image-layer"),L.DomUtil.addClass(a,"leaflet-zoom-animated"),this._mutantCanvas.parentElement.removeChild(this._mutantCanvas),a.appendChild(this._mutantCanvas),this._map._canvasOverlay=this._canvasOverlay}this._canvasOverlay.addTo(this._map),this._updateOpacity(),this._mutantCanvas.style.width="100%",this._mutantCanvas.style.height="100%",this._mutantCanvas.style.position="absolute",this._mutantCanvas.style.top=0,this._mutantCanvas.style.left=0}this.options.debugRectangle&&(this.rectangle?this.rectangle.setBounds(t):this.rectangle=L.rectangle(t,{fill:!1}).addTo(this._map))},this)}},setOpacity:function(t){return this.options.opacity=t,this._updateOpacity(),this},_updateOpacity:function(){this._mutantCanvas&&L.DomUtil.setOpacity(this._mutantCanvas,this.options.opacity)},_initMapkitAttribution:function(t){this._map._mutantLogo?(this._mutantLogo=this._map._mutantLogo,this._map._controlCorners.bottomleft.appendChild(this._mutantLogo)):requestAnimationFrame(function a(){if(this._mutantLogo=this._mutantContainer.querySelector(".mk-logo-control"),this._mutantLogo){this._mutantLogo.parentElement.removeChild(this._mutantLogo);var i=L.DomUtil.create("div");t!==mapkit.Map.MapTypes.Standard&&(i.className="mk-dark-mode"),i.appendChild(this._mutantLogo),this._mutantLogo=i,this._map._mutantLogo=this._mutantLogo,this._map._controlCorners.bottomleft.appendChild(this._mutantLogo)}else requestAnimationFrame(a.bind(this))}.bind(this)),this._map._mutantLegal?(this._mutantLegal=this._map._mutantLegal,t===mapkit.Map.MapTypes.Standard?this._mutantLegal.className="":this._mutantLegal.className="mk-dark-mode",this._map._controlCorners.bottomright.appendChild(this._mutantLegal)):requestAnimationFrame(function a(){if(this._mutantLegal=this._mutantContainer.querySelector(".mk-legal-controls"),this._mutantLegal){this._mutantLegal.parentElement.removeChild(this._mutantLegal);var i=L.DomUtil.create("div");t!==mapkit.Map.MapTypes.Standard&&(i.className="mk-dark-mode"),i.appendChild(this._mutantLegal),this._mutantLegal=i,this._map._mutantLegal=this._mutantLegal,this._map._controlCorners.bottomright.appendChild(this._mutantLegal)}else requestAnimationFrame(a.bind(this))}.bind(this))},_initMutantStyles:function(t){this._mutantStyles=document.createElement("style"),this._mutantStyles.textContent=".leaflet-control-attribution{display:none}.mk-logo-control img.mk-logo.mk-logo-wordmark{margin: 0 10px 7px 10px}.mk-legal-controls{margin-right:0;margin-bottom:0;display:inline-block;vertical-align:top;margin-bottom:2px;pointer-events:auto;overflow:hidden;position:static;left:0;bottom:0}.mk-legal-controls :focus{outline:0}.mk-legal-controls .mk-legal{padding:4px 5px}",t===mapkit.Map.MapTypes.Standard?this._mutantStyles.textContent+=".leaflet-container{background-color:#f9f5ed}":this._mutantStyles.textContent+=".leaflet-container{background-color:#404040}",document.querySelector("head").appendChild(this._mutantStyles)},_delayedUpdate:function(t){if(this._map){var a=this._map.getSize(),i=0;setTimeout(function e(){if(this._map){var n=this._map.getSize();a.x===n.x&&a.y===n.y?(this._update(t),i++,i<10&&setTimeout(e.bind(this),40*i)):(i=0,a=n,setTimeout(e.bind(this),40))}}.bind(this),40)}},setElementSize:function(t,a){t.style.width=a.x+"px",t.style.height=a.y+"px"}}),L.mapkitMutant=function(t){return new L.MapkitMutant(t)};