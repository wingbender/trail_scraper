!function(i){if("function"==typeof define&&define.amd)define(["leaflet","lethargy"],i);else if("undefined"!=typeof module)module.exports=i(require("leaflet"),require("lethargy"));else{if("undefined"==typeof window.L)throw new Error("Leaflet must be loaded first");if("undefined"==typeof window.Lethargy)throw new Error("Lethargy must be loaded first");i(window.L,window.Lethargy)}}(function(i,t){"use strict";var n=i.icon({iconUrl:"https://sc.wklcdn.com/images/flag.png",iconSize:[32,32],iconAnchor:[16,32],tooltipAnchor:[8,-22]}),o=i.icon({iconUrl:"https://www.google.com/mapfiles/dd-start.png",iconSize:[20,34],iconAnchor:[10,34]}),e=i.icon({iconUrl:"https://www.google.com/mapfiles/dd-end.png",iconSize:[20,34],iconAnchor:[10,34]}),l=i.icon({iconUrl:"https://maps.google.com/mapfiles/kml/pal5/icon6.png",iconSize:[32,32],iconAnchor:[16,27]});i.WklPolyline=i.Polyline.extend({options:{color:"#ff9933"},getDistance:function(){return this.getLatLngs().map(function(i,t,n){return 0===t?0:n[t-1].distanceTo(i)}).reduce(function(i,t){return i+t},0)},getLastLatLng:function(){return this.getLatLngs()[this.getLatLngs().length-1]}}),i.wklPolyline=function(t,n){return new i.WklPolyline(t,n)},i.WklMarker=i.Marker.extend({options:{name:"",image:null},initialize:function(t,n){i.Marker.prototype.initialize.call(this,t,n),i.Util.setOptions(this,n),this._createTooltip()},setName:function(i){this.options.name=i,this._createTooltip()},toGeoJSON:function(){var t=i.Marker.prototype.toGeoJSON.call(this);return this.options.name&&(t.properties.name=this.options.name),this.options.image&&(t.properties.image=this.options.image),t},_createTooltip:function(){if(this.options.name){var t=i.DomUtil.create("div","leaflet-tooltip-wkl");if(this.options.image){var n=i.DomUtil.create("img","leaflet-tooltip-img",t);n.src=this.options.image,n.alt=this.options.name}var o=i.DomUtil.create("div","leaflet-tooltip-text",t);o.innerText=this.options.name,this.bindTooltip(t),this.on("mouseover",function(){this.openTooltip()}),this.on("mouseout",function(){this.closeTooltip()})}}}),i.WklWaypoint=i.WklMarker.extend({options:{icon:n,riseOnHover:!0,spaId:null},toGeoJSON:function(){var t=i.WklMarker.prototype.toGeoJSON.call(this);return this.options.spaId&&(t.properties.spaId=this.options.spaId),t}}),i.wklWaypoint=function(t,n){return new i.WklWaypoint(t,n)},i.WklBeginpoint=i.WklMarker.extend({options:{icon:o,riseOnHover:!0}}),i.wklBeginpoint=function(t,n){return new i.WklBeginpoint(t,n)},i.WklEndpoint=i.WklMarker.extend({options:{icon:e,riseOnHover:!0}}),i.wklEndpoint=function(t,n){return new i.WklEndpoint(t,n)},i.WklHighlight=i.Marker.extend({options:{icon:l,riseOnHover:!0}}),i.wklHighlight=function(t,n){return new i.WklHighlight(t,n)},i.WklTrail=i.WklPolyline.extend({options:{wpts:[],wptOnClick:function(){},beginPointOnClick:function(){},isLoop:!1,showBeginEndpoints:!0,beginPointTooltipEnabled:!1,beginPointName:null,beginPointThumbnail:null},initialize:function(t,n){i.WklPolyline.prototype.initialize.call(this,t,n),i.Util.setOptions(this,n),this.options.beginPointTooltipEnabled?this._beginpoint=i.wklBeginpoint(t[0],{name:this.options.beginPointName,image:this.options.beginPointThumbnail}):this._beginpoint=i.wklBeginpoint(t[0]),this._beginpoint.on("click",this.options.beginPointOnClick),this._endpoint=i.wklEndpoint(t[t.length-1]),this._wptMarkers=this.options.wpts.map(function(t){var n=i.wklWaypoint([t.lat,t.lng],{spaId:t.spaId,name:t.name,image:t.image});return n.on("click",this.options.wptOnClick.bind(n,t)),n}.bind(this))},beforeAdd:function(t){i.WklPolyline.prototype.beforeAdd.call(this,t),this._wptMarkers.forEach(function(i){i.addTo(t)}),this._beginpoint.addTo(t),this.options.isLoop||this._endpoint.addTo(t)},onRemove:function(){return i.WklPolyline.prototype.onRemove.call(this),this._wptMarkers.forEach(function(i){i.remove()}),this._beginpoint.remove(),this._endpoint.remove(),this}}),i.PolylineUtil&&(i.WklTrail.fromEncoded=function(t,n){return new i.WklTrail(i.PolylineUtil.decode(t),n)}),window.twkb&&(i.WklTrail.fromTwkbBase64=function(t,n){var o=twkb.toGeoJSON(base64ToUint8Array(t)),e=o.features[0].geometry.coordinates;return new i.WklTrail(e.map(function(i){return[i[1],i[0]]}),n)}),i.wklTrail=function(t,n){return new i.WklTrail(t,n)},i.i18n=i.i18n||{};var r=new t(5,25,.05);i.Map.ScrollWheelZoom.prototype._onWheelScroll=function(t){if(i.DomEvent.stop(t),r.check(t)!==!1){var n=this._map.options.wheelDebounceTime,o=i.DomEvent.getWheelDelta(t);this._delta+=o,this._lastMousePos=this._map.mouseEventToContainerPoint(t),this._startTime||(this._startTime=+new Date);var e=Math.max(n-(+new Date-this._startTime),0);clearTimeout(this._timer),this._timer=setTimeout(i.Util.bind(this._performZoom,this),e)}}});