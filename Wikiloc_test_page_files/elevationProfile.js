"use strict";function mapDistanceToCoordIndex(o,t){return recursiveDistanceToCoordIndex(o,t,0,t.length-1)}function recursiveDistanceToCoordIndex(o,t,e,r){if(r-e<=1)return e;var n=Math.floor((r-e)/2)+e;return o>accumDistances[n]?recursiveDistanceToCoordIndex(o,t,n,r):recursiveDistanceToCoordIndex(o,t,e,n)}function showSpotOnTrack(o){var t=svgWrapper.width(),e=mapDistanceToCoordIndex(accumDistances[accumDistances.length-1]*o/t,coordinates),r=new L.LatLng(latLngs[e][0],latLngs[e][1]);1==trinfo.units.y?pmAlt.text(Math.round(3.2808399*elevations[e]).toLocaleString(isoLang)+trinfo.units.ly):pmAlt.text(elevations[e].toLocaleString(isoLang)+trinfo.units.ly);var n=trinfo.l/t*o;1==trinfo.units.x?pmPos.text((Math.round(n/1852*10)/10).toLocaleString(isoLang)+" "+trinfo.units.lx):2==trinfo.units.x?pmPos.text((Math.round(.621371192*n/100)/10).toLocaleString(isoLang)+" "+trinfo.units.lx):pmPos.text((Math.round(n/100)/10).toLocaleString(isoLang)+" "+trinfo.units.lx),positionDot.attr("cx",trinfo.polylineCoods[e][0]).attr("cy",trinfo.polylineCoods[e][1]),gProfileHint.setLatLng(r),trailMap.hasLayer(gProfileHint)||gProfileHint.addTo(trailMap),trailMap.getBounds().contains(r)||queuePan||(queuePan=setTimeout(function(){trailMap.panTo(r),queuePan=!1},300))}function getOffsetX(o,t){var e;return e=window.TouchEvent&&o.originalEvent instanceof TouchEvent?Math.floor(o.originalEvent.touches[0].pageX-t.offset().left):Math.floor(o.pageX-t.offset().left)}function setPositionMarker(o,t){posMarker.show(),posMarkerCurrentAlt.show(),posMarkerCurrentPos.show(),positionDot.show();var e;if(e=o?getOffsetX(o,t):parseInt(posMarker.css("left"),10),e>=0&&e<svgWrapper.width()){showSpotOnTrack(e);var r=parseInt(posMarkerCurrentAlt.css("width"),10),n=parseInt(posMarkerCurrentPos.css("width"),10),i=svgWrapper.width();e-n/2<0?posMarkerCurrentPos.css("left",0):e+n/2>i?posMarkerCurrentPos.css("left",i-n):posMarkerCurrentPos.css("left",e-n/2),e-r/2<0?posMarkerCurrentAlt.css("left",0):e+r/2>i?posMarkerCurrentAlt.css("left",i-r):posMarkerCurrentAlt.css("left",e-r/2),posMarker.css("left",e)}}function initElevationProfile(){elevationProfileSvg.render({el:elevationChartContainer,width:elevationChartContainer.offsetWidth,height:elevationChartContainer.offsetHeight,elevations:elevations,accumDistances:accumDistances,minElevation:minElevation,maxElevation:maxElevation}),elevationProfile=$("#elevation-profile"),posMarker=$("#pos-marker"),posMarkerCurrentAlt=$("#pos-marker-current-alt"),posMarkerCurrentPos=$("#pos-marker-current-pos"),positionDot=$("#position-dot"),svgWrapper=$(".svg-wrapper"),trinfo&&(trinfo.polylineCoods=elevationProfileSvg.getPolylineCoords(),trinfo.polylineCoods.shift(),trinfo.polylineCoods.pop()),svgWrapper.off(),svgWrapper.on("mouseover touchstart",function(o){posMarkerCurrentAlt.show(),posMarkerCurrentPos.show(),positionDot.show()}).on("mouseout",function(o){posMarker.hide(),posMarkerCurrentAlt.hide(),posMarkerCurrentPos.hide(),positionDot.hide(),trailMap.hasLayer(gProfileHint)&&gProfileHint.remove()}).on("mousemove touchmove",function(o){setPositionMarker(o,$(this))}),elevationProfile.on("mouseover touchstart",function(o){trailMap.dragging.disable()}).on("mouseout touchend",function(o){trailMap.dragging.enable()})}var elevationProfile,svgWrapper,positionDot,posMarker,posMarkerCurrentAlt,posMarkerCurrentPos,gProfileHint;gProfileHint="undefined"!=typeof gProfileHintCustom?gProfileHintCustom:L.circleMarker([0,0],{radius:6,weight:2,color:"white",fill:!0,fillColor:"#008fe8",fillOpacity:1});var queuePan,pmAlt=$("#pm-alt"),pmPos=$("#pm-pos"),twkbB64=mapData.mapData.filter(function(o){return!o.waypoint})[0].geom,geojson=twkb.toGeoJSON(base64ToUint8Array(twkbB64)),coordinates=geojson.features[0].geometry.coordinates,accumDistances=coordinates.reduce(function(o,t,e,r){var n=r[e-1<0?0:e-1],i=o.length>0?o[o.length-1]:0;return o.push(i+L.CRS.EPSG4326.distance(L.latLng(n[1],n[0]),L.latLng(t[1],t[0]))),o},[]),latLngs=coordinates.map(function(o){return[o[1],o[0]]}),elevations=coordinates.map(function(o){return[o[2]]});$(document).ready(function(){initElevationProfile(),$(".el-button").click(function(o){$("#elevation-profile").toggle(),$("#elevation-profile-but").toggle(),trailMap.dragging.enable(),o.stopPropagation()}),$("#elevation-profile-but").on("click",function(o){$("#elevation-profile").toggle(),$("#elevation-profile-but").toggle()}),window.addEventListener("resize",function(){var o="none"!==positionDot.css("display");initElevationProfile(),o&&setPositionMarker()},!1)});